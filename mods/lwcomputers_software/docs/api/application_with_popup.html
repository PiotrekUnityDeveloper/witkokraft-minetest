<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Application with Popup</title>
    <meta name="author" content="loosewheel">
    <style>a:link {text-decoration:none;}</style>
  </head>
  <body style="font-family: sans-serif;">
    <h1 style="background-color: rgb(128, 128, 255); padding: 8pt;"><a
        name="top"></a>Application with Popup - WIN</h1>
    Dialog windows are commonly used for specific actions and/or getting
    information from the user. The <a moz-do-not-send="true"
      href="popupFrame.html">popupFrame</a> window is a modal state
    window. The frame window it is created from (the owner frame) is
    disabled and the threads code halts, so the user must respond to the
    popup before continuing. The following introduces a <a
      moz-do-not-send="true" href="popupFrame.html">popupFrame</a>
    window to our program defined as a class derived from <a
      moz-do-not-send="true" href="popupFrame.html">popupFrame</a>. It
    takes a string from the user and sets it as the application's title
    text.<br>
    <br>
    <pre><font color="#cc0000">-- collect any program arguments</font><br><font color="#330099">local</font> app_args = { ... }<br><br><font color="#cc0000">-- create the application's main frame</font><br><font color="#330099">local</font> appFrame = win.create_app_frame ()<br><br><br><font color="#330099">local</font> APP_TITLE      = <font color="#ffcc00">"Popup"</font><br><br><font color="#cc0000">-- ids should be between 1 - 65535</font><br><br><font color="#cc0000">-- control ids</font><br><font color="#330099">local</font> ID_MENUBTN     = <font color="#339999">101</font><br><font color="#330099">local</font> ID_SETTITLEBTN = <font color="#339999">102</font><br><br><font color="#cc0000">-- popup ids</font><br><font color="#330099">local</font> ID_TITLETEXT   = <font color="#339999">201</font><br><font color="#330099">local</font> ID_OK          = <font color="#339999">202</font><br><br><font color="#cc0000">-- command ids</font><br><font color="#330099">local</font> IDM_ONE        = <font color="#339999">1001</font><br><font color="#330099">local</font> IDM_TWO        = <font color="#339999">1002</font><br><font color="#330099">local</font> IDM_THREE      = <font color="#339999">1003</font><br><font color="#330099">local</font> IDM_QUITAPP    = <font color="#339999">1004</font><br><br><font color="#cc0000">-- unique id for app frame</font><br><font color="#330099">local</font> ID_MYAPP_FRAME = <font color="#339999">32174</font><br><br><br><font color="#cc0000">-- myPopup class -------------------------------------------------------</font><br><font color="#330099">local</font> myPopup = win.popupFrame:base ()<br><br><br><font color="#cc0000">-- return false on failure</font><br><font color="#330099">function</font> myPopup:on_create ()<br>   self:dress (<font color="#ffcc00">"Set Title"</font>)<br><br>   <font color="#330099">local</font> inputWnd = win.inputWindow:new (self, ID_TITLETEXT, <font color="#339999">1</font>, <font color="#339999">2</font>, <font color="#339999">14</font>,<br>                                         self:get_owner ():get_text (), <font color="#ffcc00">"Title"</font>)<br>   inputWnd:set_sel (<font color="#339999">0</font>, -<font color="#339999">1</font>)<br>   inputWnd:set_focus ()<br><br>   win.buttonWindow:new (self, ID_OK, <font color="#339999">11</font>, <font color="#339999">4</font>, <font color="#ffcc00">" Ok "</font>)<br><br>   self:move (<font color="#330099">nil</font>, <font color="#330099">nil</font>, <font color="#339999">16</font>, <font color="#339999">6</font>)<br><br>   <font color="#330099">return true</font><br><font color="#330099">end</font><br><br><br><font color="#cc0000">-- handles events for myPopup</font><br><font color="#330099">function</font> myPopup:on_event (event, p1, p2, p3, p4, p5, ...)<br>   <font color="#330099">if</font> event == <font color="#ffcc00">"btn_click"</font> <font color="#330099">then</font><br>      <font color="#330099">if</font> p1:get_id () == ID_OK <font color="#330099">then</font><br>         <font color="#330099">local</font> titleText = APP_TITLE<br>         <font color="#330099">local</font> titleWnd = self:get_wnd_by_id (ID_TITLETEXT)<br><br>         <font color="#330099">if</font> titleWnd <font color="#330099">then</font><br>            <font color="#330099">if</font> string.len (titleWnd:get_text ()) &gt; <font color="#339999">0</font> <font color="#330099">then</font><br>               titleText = titleWnd:get_text ()<br>            <font color="#330099">end</font><br>         <font color="#330099">end</font><br><br>         self:get_owner ():set_title (titleText)<br><br>         self:close (ID_OK)<br><br>         <font color="#330099">return true</font><br>      <font color="#330099">end</font><br>   <font color="#330099">end</font><br><br>   <font color="#330099">return false</font><br><font color="#330099">end</font><br><font color="#cc0000">-- end myPopup class ---------------------------------------------------</font><br><br><br><font color="#cc0000">-- handle control, wanted and custom events</font><br><font color="#330099">function</font> appFrame:on_event (event, p1, p2, p3, p4, p5, ...)<br>   <font color="#cc0000">-- handle events and return true</font><br>   <font color="#330099">if</font> event == <font color="#ffcc00">"btn_click"</font> <font color="#330099">then</font><br>      <font color="#330099">if</font> p1:get_id () == ID_MENUBTN <font color="#330099">then</font><br>         self:on_menu ()<br>         <font color="#330099">return true</font><br>      <font color="#330099">end</font><br><br>      <font color="#cc0000">-- run popup on btn click</font><br>      <font color="#330099">if</font> p1:get_id () == ID_SETTITLEBTN <font color="#330099">then</font><br>         myPopup:new (self):do_modal ()<br>         <font color="#330099">return true</font><br>      <font color="#330099">end</font><br><br>   <font color="#330099">elseif</font> event == <font color="#ffcc00">"menu_cmd"</font> <font color="#330099">then</font><br>      <font color="#330099">return</font> self:on_command (p1)<br>   <font color="#330099">end</font><br><br>   <font color="#330099">return false</font><br><font color="#330099">end</font><br><br><br><font color="#cc0000">-- if needed, low priority, called about every 1/3 second</font><br><font color="#cc0000">-- when nothing happening - but keep it brief</font><br><font color="#330099">function</font> appFrame:on_idle (idle_count)<br>   <font color="#330099">return false</font><br><font color="#330099">end</font><br><br><br><font color="#cc0000">-- if needed</font><br><font color="#330099">function</font> appFrame:on_alarm (alarm_id)<br>   <font color="#330099">return false</font><br><font color="#330099">end</font><br><br><br><font color="#cc0000">-- if needed</font><br><font color="#330099">function</font> appFrame:on_timer (timer_id)<br>   <font color="#330099">return false</font><br><font color="#330099">end</font><br><br><br><font color="#cc0000">-- to reposition control windows, app frames should only</font><br><font color="#cc0000">-- move if monitor device changes size/resolution or</font><br><font color="#cc0000">-- fullscreen mode changes</font><br><font color="#330099">function</font> appFrame:on_move ()<br>   <font color="#330099">return false</font><br><font color="#330099">end</font><br><br><br><font color="#cc0000">-- for clean up, if needed</font><br><font color="#330099">function</font> appFrame:on_destroy_wnd ()<br><font color="#330099">end</font><br><br><br><font color="#cc0000">-- to implement accelerator keys. best to use with combo keys</font><br><font color="#cc0000">-- to try and avoid char event following to child</font><br><font color="#330099">function</font> appFrame:on_child_key (wnd, key, ctrl, alt, shift)<br>   <font color="#cc0000">-- base implements tab key navigation</font><br>   <font color="#330099">if</font> win.applicationFrame.on_child_key (self, wnd, key, ctrl, alt, shift) <font color="#330099">then</font><br>      <font color="#330099">return true</font><br>   <font color="#330099">end</font><br><br>   <font color="#cc0000">-- return true if handled so child does not receive key event</font><br><br>   <font color="#cc0000">-- accelerators to menu commands</font><br>   <font color="#330099">if</font> ctrl <font color="#330099">and not</font> alt <font color="#330099">and not</font> shift <font color="#330099">then</font><br>      <font color="#330099">if</font> key == keys.KEY_1 <font color="#330099">then</font><br>         <font color="#330099">return</font> self:on_command (IDM_ONE)<br>      <font color="#330099">end</font><br><br>      <font color="#330099">if</font> key == keys.KEY_2 <font color="#330099">then</font><br>         <font color="#330099">return</font> self:on_command (IDM_TWO)<br>      <font color="#330099">end</font><br><br>      <font color="#330099">if</font> key == keys.KEY_3 <font color="#330099">then</font><br>         <font color="#330099">return</font> self:on_command (IDM_THREE)<br>      <font color="#330099">end</font><br>   <font color="#330099">end</font><br><br>   <font color="#330099">return false</font><br><font color="#330099">end</font><br><br><br><font color="#cc0000">-- called when app becomes and stops being the active app</font><br><font color="#330099">function</font> appFrame:on_frame_activate (active)<br><font color="#330099">end</font><br><br><br><font color="#cc0000">-- called when app is quitting</font><br><font color="#330099">function</font> appFrame:on_quit ()<br>   <font color="#cc0000">-- return true to stop app from quitting</font><br><br>   <font color="#330099">return false</font><br><font color="#330099">end</font><br><br><br><font color="#cc0000">-- method to create and display menu</font><br><font color="#330099">function</font> appFrame:on_menu ()<br>   <font color="#330099">local</font> menu = win.menuWindow:new (self)<br><br>   menu:add_string (<font color="#ffcc00">"One   Ctrl+1"</font>,   IDM_ONE)<br>   menu:add_string (<font color="#ffcc00">"Two   Ctrl+2"</font>,   IDM_TWO)<br>   menu:add_string (<font color="#ffcc00">"Three Ctrl+3"</font>,   IDM_THREE)<br>   menu:add_string (<font color="#ffcc00">"------------"</font>)<br>   menu:add_string (<font color="#ffcc00">"Quit App"</font>,       IDM_QUITAPP)<br><br>   menu:track (<font color="#339999">0</font>, <font color="#339999">1</font>)<br><font color="#330099">end</font><br><br><br><font color="#cc0000">-- command handler</font><br><font color="#330099">function</font> appFrame:on_command (cmd_id)<br>   <font color="#330099">if</font> cmd_id == IDM_ONE <font color="#330099">then</font><br>      self:msgbox (<font color="#ffcc00">"Menu Command"</font>, <font color="#ffcc00">"Application message box."</font>)<br>      <font color="#330099">return true</font><br>   <font color="#330099">end</font><br><br>   <font color="#330099">if</font> cmd_id == IDM_TWO <font color="#330099">then</font><br>      self:msgbox (<font color="#ffcc00">"Menu Command"</font>,<br>                   <font color="#ffcc00">"Application message box with custom color."</font>,<br>                   term.colors.sky)<br>      <font color="#330099">return true</font><br>   <font color="#330099">end</font><br><br>   <font color="#330099">if</font> cmd_id == IDM_THREE <font color="#330099">then</font><br>      self:get_desktop ():msgbox (<font color="#ffcc00">"Menu Command"</font>,<br>                                  <font color="#ffcc00">"System message box with custom color."</font>,<br>                                  term.colors.red)<br>      <font color="#330099">return true</font><br>   <font color="#330099">end</font><br><br>   <font color="#330099">if</font> cmd_id == IDM_QUITAPP <font color="#330099">then</font><br>      self:quit_app ()<br>      <font color="#330099">return true</font><br>   <font color="#330099">end</font><br><br>   <font color="#330099">return false</font><br><font color="#330099">end</font><br><br><br><font color="#330099">function</font> appFrame:on_create ()<br>   <font color="#cc0000">-- single instance, look for existing frame</font><br>   <font color="#330099">local</font> instance = self:get_desktop ():get_wnd_by_id (ID_MYAPP_FRAME, <font color="#330099">false</font>)<br><br>   <font color="#cc0000">-- if found</font><br>   <font color="#330099">if</font> instance <font color="#330099">then</font><br>      <font color="#cc0000">-- bring running instance to top</font><br>      instance:set_active_top_frame ()<br><br>      <font color="#cc0000">-- and drop out</font><br>      <font color="#330099">return false</font><br>   <font color="#330099">end</font><br><br>   <font color="#cc0000">-- not found, change frame id to ID_MYAPP_FRAME</font><br>   self:set_id (ID_MYAPP_FRAME)<br><br>   <font color="#cc0000">-- add title bar and close btn, close btn will have focus</font><br>   <font color="#cc0000">-- frame wnd text displays in running app list</font><br>   self:dress (APP_TITLE)<br><br>   <font color="#cc0000">-- create menu button on title bar</font><br>   <font color="#330099">local</font> menu_btn = win.buttonWindow:new (self, ID_MENUBTN, <font color="#339999">0</font>, <font color="#339999">0</font>, <font color="#ffcc00">"Menu"</font>)<br>   <font color="#cc0000">-- customise to blend into title bar</font><br>   menu_btn:set_colors (menu_btn:get_colors ().frame_text,<br>                        menu_btn:get_colors ().title_back,<br>                        menu_btn:get_colors ().frame_back)<br>   <font color="#cc0000">-- move on top of title bar text so wont get obscured</font><br>   menu_btn:move (<font color="#330099">nil</font>, <font color="#330099">nil</font>, <font color="#330099">nil</font>, <font color="#330099">nil</font>, win.WND_TOP)<br><br><br>   <font color="#cc0000">-- create controls, usually setting focus to first</font><br>   win.buttonWindow:new (self, ID_SETTITLEBTN, <font color="#339999">2</font>, <font color="#339999">3</font>, <font color="#ffcc00">" Set Title "</font>):set_focus ()<br><br><br>   <font color="#cc0000">-- app is constructed, bring it to top</font><br>   self:set_active_top_frame ()<br><br>   <font color="#330099">return true</font><br><font color="#330099">end</font><br><br><br><font color="#cc0000">-- run the application's loop</font><br>appFrame:run_app ()</pre>
    <br>
    <br>
    See <a moz-do-not-send="true" href="application_writing.html">Application
      Writing</a>, <a moz-do-not-send="true" href="index.html">WIN</a>.<br>
    <br>
    <br>
  </body>
</html>
